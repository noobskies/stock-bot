{% extends "base.html" %} {% block title %}Settings - AI Trading Bot{% endblock
%} {% block content %}
<div class="settings-page">
  <div class="page-header">
    <h2>Bot Settings</h2>
    <p class="page-subtitle">
      Configure trading parameters and risk management
    </p>
  </div>

  <!-- Trading Settings -->
  <div class="settings-section">
    <h3>Trading Configuration</h3>
    <div class="settings-grid">
      <div class="setting-item">
        <label>Trading Mode</label>
        <select id="tradingMode" class="setting-input">
          <option value="auto">Auto</option>
          <option value="manual">Manual</option>
          <option value="hybrid">Hybrid</option>
        </select>
        <p class="setting-description">
          Auto: All high-confidence signals execute automatically. Manual: All
          signals require approval. Hybrid: High confidence auto, medium
          requires approval.
        </p>
      </div>
      <div class="setting-item">
        <label>Close Positions EOD</label>
        <input type="checkbox" id="closeEOD" class="setting-checkbox" />
        <p class="setting-description">
          Close all positions at end of day to eliminate gap risk.
        </p>
      </div>
    </div>
  </div>

  <!-- Risk Management -->
  <div class="settings-section">
    <h3>Risk Management</h3>
    <div class="settings-grid">
      <div class="setting-item">
        <label>Risk Per Trade (%)</label>
        <input
          type="number"
          id="riskPerTrade"
          class="setting-input"
          min="0.5"
          max="5"
          step="0.1"
          value="2"
        />
        <p class="setting-description">
          Maximum risk per trade as percentage of portfolio.
        </p>
      </div>
      <div class="setting-item">
        <label>Stop Loss (%)</label>
        <input
          type="number"
          id="stopLoss"
          class="setting-input"
          min="1"
          max="10"
          step="0.5"
          value="3"
        />
        <p class="setting-description">
          Initial stop loss percentage below entry price.
        </p>
      </div>
      <div class="setting-item">
        <label>Trailing Stop (%)</label>
        <input
          type="number"
          id="trailingStop"
          class="setting-input"
          min="0.5"
          max="5"
          step="0.5"
          value="2"
        />
        <p class="setting-description">
          Trailing stop distance when profit target reached.
        </p>
      </div>
      <div class="setting-item">
        <label>Daily Loss Limit (%)</label>
        <input
          type="number"
          id="dailyLossLimit"
          class="setting-input"
          min="3"
          max="10"
          step="1"
          value="5"
        />
        <p class="setting-description">
          Circuit breaker - stop trading if daily loss exceeds this.
        </p>
      </div>
    </div>
  </div>

  <!-- ML Configuration -->
  <div class="settings-section">
    <h3>ML Configuration</h3>
    <div class="settings-grid">
      <div class="setting-item">
        <label>Confidence Threshold (%)</label>
        <input
          type="number"
          id="confidenceThreshold"
          class="setting-input"
          min="50"
          max="90"
          step="5"
          value="70"
        />
        <p class="setting-description">
          Minimum confidence required to generate signal.
        </p>
      </div>
      <div class="setting-item">
        <label>Auto Execute Threshold (%)</label>
        <input
          type="number"
          id="autoExecuteThreshold"
          class="setting-input"
          min="70"
          max="95"
          step="5"
          value="80"
        />
        <p class="setting-description">
          Confidence level for automatic execution (hybrid mode).
        </p>
      </div>
    </div>
  </div>

  <!-- Account Info -->
  <div class="settings-section">
    <h3>Account Information</h3>
    <div class="info-grid">
      <div class="info-item">
        <label>Trading Mode</label>
        <div id="tradingModeInfo" class="info-value">Loading...</div>
      </div>
      <div class="info-item">
        <label>Target Symbols</label>
        <div id="symbolsInfo" class="info-value">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Save Button -->
  <div class="settings-actions">
    <button class="btn btn-primary" onclick="saveSettings()">
      Save Settings
    </button>
    <button class="btn btn-secondary" onclick="loadSettings()">Reset</button>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", loadSettings);

  async function loadSettings() {
    try {
      const response = await fetch("/api/settings");
      const data = await response.json();

      if (data.error) {
        showToast(data.error, "error");
        return;
      }

      // Trading settings
      document.getElementById("tradingMode").value = data.trading.mode;
      document.getElementById("closeEOD").checked =
        data.trading.close_positions_eod;

      // Risk settings
      document.getElementById("riskPerTrade").value =
        data.risk.risk_per_trade * 100;
      document.getElementById("stopLoss").value =
        data.risk.stop_loss_percent * 100;
      document.getElementById("trailingStop").value =
        data.risk.trailing_stop_percent * 100;
      document.getElementById("dailyLossLimit").value =
        data.risk.daily_loss_limit * 100;

      // ML settings
      document.getElementById("confidenceThreshold").value =
        data.ml.prediction_confidence_threshold * 100;
      document.getElementById("autoExecuteThreshold").value =
        data.ml.auto_execute_threshold * 100;

      // Account info
      document.getElementById("tradingModeInfo").textContent =
        data.is_paper_trading ? "Paper Trading" : "Live Trading";
      document.getElementById("symbolsInfo").textContent =
        data.trading.symbols.join(", ");
    } catch (error) {
      console.error("Error loading settings:", error);
      showToast("Failed to load settings", "error");
    }
  }

  async function saveSettings() {
    try {
      const settings = {
        trading: {
          mode: document.getElementById("tradingMode").value,
          close_positions_eod: document.getElementById("closeEOD").checked,
        },
        risk: {
          risk_per_trade:
            parseFloat(document.getElementById("riskPerTrade").value) / 100,
          stop_loss_percent:
            parseFloat(document.getElementById("stopLoss").value) / 100,
          trailing_stop_percent:
            parseFloat(document.getElementById("trailingStop").value) / 100,
          daily_loss_limit:
            parseFloat(document.getElementById("dailyLossLimit").value) / 100,
        },
        ml: {
          prediction_confidence_threshold:
            parseFloat(document.getElementById("confidenceThreshold").value) /
            100,
          auto_execute_threshold:
            parseFloat(document.getElementById("autoExecuteThreshold").value) /
            100,
        },
      };

      const response = await fetch("/api/settings", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(settings),
      });

      const data = await response.json();

      if (data.success) {
        showToast("Settings saved successfully", "success");
      } else {
        showToast(data.error || "Failed to save settings", "error");
      }
    } catch (error) {
      console.error("Error saving settings:", error);
      showToast("Error saving settings", "error");
    }
  }
</script>
{% endblock %}
